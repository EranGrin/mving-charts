<!DOCTYPE html>
<html lang="de">

<meta charset="utf-8" />

<head>
  <script src="https://cdn.plot.ly/plotly-latest.min.js">
  </script>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
    }

    #graph {
      vertical-align: top;
    }
  </style>
</head>

<body>
  <div id="graph"></div>

  <script>
    'use strict'

    Plotly.d3.csv('./product-bar.csv', function(err, rows) {

      function unpack(rows, key) {
        return rows.map(function(row) {
          return row[key];
        });
      }

      class Trace { // should be based on the measure elements
        constructor(x, y, name) {
          this.x = [x];
          this.y = [y];
          this.name = name;
          this.type = 'bar';
          //this.mode = 'bar';
          this.id = y;
          // this.text = y;
        }
      }

      // declare variables for the columns
      let measureTime = 'year'
      let measureElementAxe = 'product';
      let measureElement = [ // maybe need to be as the order in the csv
        'sells',
        'costs'
      ];

      let data = [];
      let arrX = [];
      let arrY = [];

      /// get the years
      let arrTime = unpack(rows, measureTime);

      for (let i = 0; i < measureElement.length; i++) {
        arrX = unpack(rows, measureElementAxe) // create an array for y
        arrY = unpack(rows, measureElement[i]) // create an array for x
        data[i] = new Trace(
          arrX[0], arrY[0], measureElement[i]
        )
      }


      let arRX = [];
      let arRY = [];





      /////// create frames and animation ///////
      /// create frames based on years - measureTime let ///

      class Frame {
        constructor(name, datA) {
          this.name = name;
          this.data = datA;

          // Object.defineProperty(Frame, "name", {
          //   value: "test"
          // });
        }
      };

      Frame.prototype.constructor = 'test'

      let frames = [];

      for (let i = 0; i < arrTime.length; i++) {
        let datA = [];
        for (let j = 0; j < measureElement.length; j++) {

          arRX = unpack(rows, measureElementAxe); // create an array for y
          arRY = unpack(rows, measureElement[j]); // create an array for x
          // console.log(i, j)
          // console.log(arRY[i])
          datA[j] = new Trace(
            arRX[0], arRY[i], measureElement[j]);
          // console.log(datA)
        };

        frames[i] = new Frame(
          arrTime[i], datA
        );
      }
      // console.log(datA)
      console.log(frames)

      ///// create the sliderSteps objects
      class SliderSteps {
        constructor(method, label, Arg) {
          this.method = method;
          this.label = label;
          this.args = Arg
        }
      }

      class Arg {
        constructor(mode, frame, transition) {
          this.mode = mode;
          this.frame = frame;
          this.transition = transition;
        }
      }



      let slidStep = [];
      for (let i = 0; i < arrTime.length; i++) {
        let arg = [];
        arg = new Arg('immediate', {
          duration: 300,
          redraw: false
        }, {
          duration: 300
        }
      )
        slidStep[i] = new SliderSteps(
          'animate', arrTime[i], ([
            [arrTime[i]], arg
          ]))
      }


// let Steps = slidStep
// delete frames[0].constructor.name;


Frame.prototype.constructor = 'test'
console.log(frames.constructor.name)
console.log(frames[0].constructor.name)

let layout = {

        sliders: [
            { pad: {
              t: 20},
              x: 0.05,
              len: 0.95,
              currentvalue: {
                    xanchor: 'right',
                    prefix: 'Year: ',
                    font: {
                        color: '#888',
                        size: 30
                          }
                        },
              transition: {
                  duration: 500
                },

          // By default, animate commands are bound to the most recently animated frame:

          /////////
          steps: slidStep

          // [{
          //   label: '2000', /// label of the changing frame at the momment color but should be year
          //   method: 'animate',
          //   args: [
          //     ['frame1'], {
          //       mode: 'immediate',
          //       frame: {
          //         redraw: false,
          //         duration: 500
          //       },
          //       transition: {
          //         duration: 500
          //       }
          //     }
          //   ]
          // }
          //
          // , {
          //   label: '2005',
          //   method: 'animate',
          //   args: [
          //     ['frame2'], {
          //       mode: 'immediate',
          //       frame: {
          //         redraw: false,
          //         duration: 500
          //       },
          //       transition: {
          //         duration: 500
          //       }
          //     }
          //   ]
          // }
          //
          //
          // , {
          //   label: '2010',
          //   method: 'animate',
          //   args: [
          //     ['frame3'], {
          //       mode: 'immediate',
          //       frame: {
          //         redraw: false,
          //         duration: 500
          //       },
          //       transition: {
          //         duration: 500
          //       }
          //     }
          //   ]
          // }]


        }],

///////////////---  Control Bar ---////////////
        updatemenus: [{
          type: 'buttons',
          showactive: false,
          x: 0.05,
          y: 0,
          xanchor: 'right',
          yanchor: 'top',
          direction: 'left',
          pad: {
            t: 60,
            r: 20
          },

          buttons: [{
            label: 'Play',
            method: 'animate',
            args: [null,

              {
              fromcurrent: true,
              frame: {
                redraw: false,
                duration: 1000
              },

              transition: {
                duration: 500
              }
            }]
          }, {
            label: 'Pause',
            method: 'animate',
            args: [
              [null], {
                mode: 'immediate',
                frame: {
                  redraw: false,
                  duration: 0
                }
              }
            ]
          }]
        }]
      }








      // let layout = {
      //
      //   xaxis: {
      //     title: 'Product',
      //     range: [-5, 5]
      //   },
      //
      //   yaxis: {
      //     title: 'Sales',
      //   },
      //   ///////////////---  Control Bar ---////////////
      //   updatemenus: [{
      //     x: 0,
      //     y: 0,
      //     yanchor: 'top',
      //     xanchor: 'left',
      //     showactive: false,
      //     direction: 'left',
      //     type: 'buttons',
      //     pad: {
      //       t: 70,
      //       r: 2
      //     },
      //     buttons: [{
      //       method: 'animate',
      //       args: [null, {
      //         mode: 'immediate',
      //         fromcurrent: true,
      //         transition: {
      //           duration: 300
      //         },
      //         frame: {
      //           duration: 500,
      //           redraw: false
      //         }
      //       }],
      //       label: 'Play'
      //     }, {
      //       method: 'animate',
      //       args: [
      //         [null], {
      //           mode: 'immediate',
      //           transition: {
      //             duration: 0
      //           },
      //           frame: {
      //             duration: 0,
      //             redraw: false
      //           }
      //         }
      //       ],
      //       label: 'Pause'
      //     }]
      //   }],
      //
      //   sliders: [{
      //     pad: {l: 130, t: 55},
      //     currentvalue: {
      //       visible: true,
      //       prefix: 'Year:',
      //       xanchor: 'right',
      //       font: {
      //         size: 20,
      //         color: '#666'
      //       }
      //     },
      //     steps: slidStep
      //   }]
      // };


      // let layout = {
      //   barmode: 'group'
      //
      //
      // };
      // console.log(layout)
      // console.log(frames)


      Plotly.newPlot('graph', {
        data: data,
        layout: layout,
        frames: frames,
        showSendToCloud:true

      });
    });
  </script>
</body>


</html>
